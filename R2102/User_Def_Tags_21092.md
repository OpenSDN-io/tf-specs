# 1. Introduction
Contrail currently support tags with auto generated tag ids. User can define a custom tag but tag id would still be autogenerated.

# 2. Problem statement
Contrail Security tags should support a user configurable field to set the corresponding BGP community associated with the tag.
This field can be set by the Contrail administrator rather than random generated.

#### Supported Device Models
N/A

# 3. Proposed solution
Mark MSB of Tag-type id(upper 16bit) and Tag value id(lower 16 bit) for customizable tag i.e a customized "tag type" would start
from 0x8000- 0xFFFF and customized "tag id" would start from 0x8000-0xFFFF. Similarly auto-generated "tag types" and "tag ids" would
be in range 0x0000-0x7FFF.

This means there would be 32k autogenerated tag-types and 32k customized tag types.
With each tag-type having 32k autogenerated tags and 32k customized tags.

e.g. Auto generated : Application=Hrapp 0x0001 0001
     User def tag with pre-def tag type: Application=FinApp(user def with val 10) 0x0001 800a
     User def tag with custom tag type: Foo=HrApp(tag id 10 tag type value 10) 0x800a 800a

# 4. API schema changes
N/A

# 5. Alternatives considered
N/A

# 6. UI changes / User workflow impact
UI changes would be needed for user to input the tag-type and tag name with values. Tag value should be in hex in following format
<tag-type>:<tag-id> e.g. 0x8005:0x8006

# 7. Notification impact
N/A

# 8. Provisioning changes
N/A

# 9. Implementation
Backend expects tag-id in hex format so any client(UI, Api client) when sending request to create a tag must have tag id in hex format.
With new implementation in config we would introduce two new ID allocators for customized(user defined) tags. So now total 4 allocators
   Index Allocator name                 Range               zk path
1. tag-type IA(index allocator)         0x0 - 0x7FFF        /id/tags/types/
2. User defined tag-type IA             0x8000-0xFFFF       /id/tags/types/UD/
3. tag-id IA                            0x0 - 0x7FFF        /id/tags/values/
4. User defined tag-id IA               0x8000-0xFFFF       /id/tags/values/UD/

Rationale of using new allocators is as we have well predefined ranges its clean to manage with different allocators.
This also allow us to create custom tag ids for pre-defined tag-types.

All implementation changes will be confined to config and UI. There is no chnage in schema as per current requirement.

# 10. Performance and scaling impact
N/A

# 11. Upgrade
N/A

# 12. Deprecations
N/A

# 13. Dependencies
N/A

# 14. Testing
## 14.1 Unit tests
New UT case will be added to verify the creation of auto-generated and user defined tag ids.

## 14.2 Feature tests
TBD

# 15. Documentation Impact
Addition of new feature should be documented for customer usecase.

# 16. References
https://contrail-jws.atlassian.net/browse/CEM-21092

# 17. Caveats or Known issues
There are no known issues.

#18. Non Goals
1. Update on UD tags would not be supported. User could create and delete the tag.
2. Auto generated tags with user defined tag-types would not be supported.

